---
title: Access Requests with Slack
description: How to set up Teleport's Slack plugin for privilege elevation approvals.
---

This guide will explain how to set up Slack to receive access request messages
from Teleport. Teleport's Slack integration notifies individuals and channels of
access requests. Users can then approve and deny access requests within Slack,
making it easier to implement security best practices without compromising
productivity.

Here is an example of sending an access request via Teleport's Slack plugin:

<video controls>
  <source
    src="../../../img/enterprise/plugins/slack/slack.mp4"
    type="video/mp4"
  />

  <source
    src="../../../img/enterprise/plugins/slack/slack.webm"
    type="video/webm"
  />

  Your browser does not support the video tag.
</video>

## Prerequisites

(!/docs/pages/includes/commercial-prereqs-tabs.mdx!)

- Slack admin privileges to create an app and install it to your workspace. Your
    Slack profile must have the "Workspace Owner" or "Workspace Admin" banner
    below your profile picture.

(!/docs/pages/includes/tctl.mdx!)

## Step 1/8. Define RBAC resources

First, ennable access requests in your Teleport cluster. For the purpose of this
guide, we will define a role that can request the built-in `editor` role and a
role that can review requests for the `editor` role. We will also define one
user for each of these roles.  

Create a file called `access-request-rbac.yaml` with the following content:

{/* TODO: Fill this in */}

```yaml


```

## Step 2/8. Install the Teleport Slack plugin

We currently only provide `linux-amd64` binaries. You can also compile these
plugins from source.

<Notice scope={["enterprise"]} type="tip">
We recommend installing Teleport plugins on the same host as the Teleport
Proxy Service. This is an ideal location as plugins have a low memory footprint
and will require access to both the public internet and the Teleport Auth Service.
</Notice>

<Tabs>
<TabItem label="Download">
  ```code
  $ curl -L -O https://get.gravitational.com/teleport-access-slack-v(=teleport.version=)-linux-amd64-bin.tar.gz
  $ tar -xzf teleport-access-slack-v(=teleport.version=)-linux-amd64-bin.tar.gz
  $ ./teleport-access-slack/install
  ```
</TabItem>
<TabItem label="From Source">
  To install from source you need `git` and `go` >= (=teleport.golang=)
  installed.

  ```code
  # Check out the teleport-plugins repository
  $ git clone https://github.com/gravitational/teleport-plugins.git
  $ cd teleport-plugins/access/slack
  $ make
  ```
  
  Place the `teleport-slack` binary into an appropriate location
  within the sytem's `PATH`, e.g., `/usr/local/bin`:

  ```code 
  $ mv ./build/teleport-slack /usr/local/bin 
  ```

</TabItem> 
</Tabs>

  Make sure the binary is installed:

  ```code
  $ teleport-slack version
  teleport-slack v(=teleport.plugin.version=) git:teleport-slack-v(=teleport.plugin.version=)-fffffffff go(=teleport.golang=)
  ```

## Step 3/8. Create a user and role for the plugin

(!docs/pages/includes/plugins/rbac.mdx!)

## Step 4/8. Export the access plugin identity

(!docs/pages/includes/plugins/identity-export.mdx!)

Place any files generated by this command into `/var/lib/teleport/plugins/slack` for later reference when configuring the plugin.

```code
# create a data directory to hold certificate files for the plugin.
$ sudo mkdir -p /var/lib/teleport/plugins/slack
$ sudo mv auth.* /var/lib/teleport/plugins/slack
```

## Step 5/8. Register a Slack app

The access request plugin for Slack receives access request events from the
Teleport Auth Service, formats them into Slack messages, and sends them to the
Slack API. For this to work, you must register a new app with the Slack API.

### Create your app

Visit [https://api.slack.com/apps](https://api.slack.com/apps) to create a new
Slack app. Click "Create an App", then "From scratch". Fill in the form as shown
below. 

![Create Slack App](../../../img/enterprise/plugins/slack/Create-a-Slack-App.png)

The "App Name" should be "Teleport". Click the "Development Slack Workspace"
dropdown and choose the workspace where you would like to see access request
messages.

### Generate an OAuth token with scopes

Next, configure your application to authenticate to the Slack API. We will do
this by generating an OAuth token that the plugin will present to the Slack API.

We will restrict the plugin to the norrowest possible permissions by using OAuth
scopes. The Slack plugin needs to post messages to your workspace as the
"Teleport" user. It also needs to read usernames and email addresses in order to
direct access request notifications from the Auth Service to the appropriate
Teleport users in Slack.

After creating your app, the Slack website will open a console where you can
specify configuration options. On the sidebar menu under "Features", click
"OAuth & Permissions".

Scroll to the "Scopes" section and click "Add an OAuth Scope" for each of the
following scopes:

- `chat:write`
- `incoming-webhook`
- `users:read`
- `users:read.email`

The result should look like this:

![API Scopes](../../../img/enterprise/plugins/slack/api-scopes.png)

After you have configured scopes for your plugin, scroll back to the top of the
OAuth & Permissions page, find the "OAuth Tokens for Your Workspace" section,
and click "Install to Workspace". You will see a summary of the permission we
configured for the Slack plugin earlier.

In "Where should Teleport post?", choose "Slackbot" as the default channel the
plugin will post to. This is a provisional value: later in this guide, we will
configure the plugin to post in the channels that work best for your
organization. 

After submitting this form, you will see an OAuth token in the "OAuth Tokens for
Your Workspace" section of "OAuth & Permissions":

![OAuth Tokens](../../../img/enterprise/plugins/slack/OAuth.png)

You will use this token later when configuring the Slack plugin.

## Step 6/8. Configure the Teleport Slack plugin

At this point, you have generated the credentials your Teleport Slack plugin
needs to communicate with your Teleport cluster and the Slack API. In this step,
you will configure the Slack plugin to use these credentials. You will also
configure the plugin to send access request updates to the most appropriate
channels for your organization.

### Generate a config file

The Teleport Slack plugin uses a config file in TOML format. Generate a
boilerplate config by running the following command: 

```code
$ teleport-slack configure > teleport-slack.toml
```

This should result in a config file like the one below:

```toml
(!examples/resources/plugins/teleport-slack.toml!)
```

### Edit the config file

Edit the following fields in the configuration file you generated with values
specific to your Teleport cluster and the Slack app you created earlier:

**`[teleport]`**

The Slack plugin uses this section to connect to the Teleport Auth Service.

<Tabs>
  <TabItem label="Self-Hosted" scope={["oss","enterprise"]}>
    
Set `addr` to the address and port of your Auth Service. This address must be
reachable from the Teleport Slack Plugin.

Set `client_key`, `client_crt`, and `root_cas` to the identity files
generated earlier:

```toml
[teleport]
addr = "localhost:3025"
client_key = "/var/lib/teleport/plugins/slack/auth.key" # Teleport GRPC client secret key
client_crt = "/var/lib/teleport/plugins/slack/auth.crt" # Teleport GRPC client certificate
root_cas = "/var/lib/teleport/plugins/slack/auth.cas"   # Teleport cluster CA certs
```
</TabItem>
  <TabItem label="Cloud" scope={["cloud"]}>

Set `addr` to  your Teleport Cloud tenant address with port `443`.

Set `identity` to the identity file generated in the earlier:

```toml
[teleport]
addr = "mytenant.teleport.sh:443"
identity = "/var/lib/teleport/plugins/slack/auth.pem"
```
  </TabItem>
</Tabs>
 
**`[slack]`**

`token`: Open [`https://api.slack.com/apps`](https://api.slack.com/apps), find
the Slack app you created earlier, navigate to the "OAuth & Permissions" tab,
copy the "Bot User OAuth Token", and paste it into this field.

**`[role_to_recipients]`**

The `role_to_recipients` map configure the channels that the Slack plugin
will notify when a user requests access to a specific role. When the Slack plugin
receives an access request notification from the Auth Service, it will look up the role being requested from the map and identify the Slack channels to notify.

Here is an example of a `role_to_recipients` map:

```toml
[role_to_recipients]
"*" = "admin-slack-channel"
"dev" = ["dev-slack-channel", "admin-slack-channel"]
"dba" = "alex@gmail.com"
```

In the `role_to_recipients` map, each key is the name of a Teleport role. Each
value configures the Slack channel (or channels) to notify. The value can be a
single string or an array of strings. Each string must be either the name of a
Slack channel (including a user's direct message channel) or the email address
of a Slack user. If the recipient is an email address, the Slack plugin will
use that email address to look up a direct message channel.

The `role_to_recipients` map must also include an entry for `"*"`, which the
plugin looks up if no other entry matches a given role name.

In the example above, if a user requests the `dev` role, the plugin will send a
message to both `dev-slack-channel` and `admin-slack-channel`. If a user
requests the `dba` role, the Slack user with the username `alex@gmail.com`, if
one exists, will recieve a DM. If any other role is requested, the plugin will
look up the `*` entry and send a message to the `admin-slack-channel`.

<Admonition title="Suggested reviewers">

Users can suggest reviewers when they create an access request, e.g.,:

```code
$ tsh request create --roles=dbadmin --reviewers=alice@example.com,ivan@example.com
```

If an access request includes suggested reviewers, the Slack plugin will add
these to the list of channels to notify. If a suggested reviewer is an email
address, the plugin will look up the the direct message channel for that
address and post a message in that channel.

</Admonition>

### Invite your Slack app

Once you have configured the channels that the Slack plugin will notify when it
receives an access request, you will need to ensure that the plugin can post in
those channels.

You have already configured the plugin to send direct messages as Slackbot. For
any other channel you mention in your `role_to_recipients` map, you will need
to invite the plugin to that channel. Navigate to the channel and enter `/invite
@teleport` in the message box. 

## Step 7/8. Test your Slack app

Assuming that Teleport is running, you've created the Slack app, and the plugin is
configured, you can now run the plugin and test the workflow!

```code
$ teleport-slack start
```

If everything works fine, the log output should look like this:

```code
$ teleport-slack start
INFO   Starting Teleport Access Slack Plugin 7.2.1: slack/app.go:80
INFO   Plugin is ready slack/app.go:101
```

Create an access request and check if the plugin works as expected with the
following steps.

### Create an access request

<Tabs>
<TabItem label="As admin">
  A Teleport admin can create an access request for another user with `tctl`.
  ```code
  # Replace USERNAME with a Teleport local user and TARGET_ROLE with a Teleport Role
  $ tctl request create USERNAME --roles=TARGET_ROLE
  ```
</TabItem>
<TabItem label="As user">
  Users can use `tsh` to create an access request and log in with approved roles.
  ```code
  # Replace TARGET_ROLE with a Teleport role
  $ tsh request new --roles=TARGET_ROLE
  Seeking request approval... (id: 8f77d2d1-2bbf-4031-a300-58926237a807)
  ```
</TabItem>
</Tabs>

The configured Slack recipients should receive a new message for the new pending request.

### Resolve the request

<Tabs>
<TabItem label="As admin">
  ```code
  # Replace REQUEST_ID with the id of the request
  $ tctl request approve REQUEST_ID
  $ tctl request deny REQUEST_ID
  ```
</TabItem>
<TabItem label="As user">
  ```code
  # Replace REQUEST_ID with the id of the request
  $ tsh request review --approve REQUEST_ID
  $ tsh request review --deny REQUEST_ID
  ```
</TabItem>
</Tabs>

Once the request is resolved, the Slack bot will make an emoji reaction of ✅ or
❌ on the Slack message for the access request, depending on whether the request
was approved or denied.

## Step 8/8. Set up systemd

In production, we recommend starting the Teleport plugin daemon via an init system like systemd.
Here's the recommended Teleport plugin service unit file for systemd:

```ini
(!examples/systemd/plugins/teleport-slack.service!)
```

Save this as `teleport-slack.service`.

## Audit log

The plugin will let anyone with access to the Slack channel approve access
requests, so it's important to review the Teleport audit log to ensure that only
the expected users are submitting reviews.

When auditing access request reviews, check for events with the type
`Access Request Reviewed` in the Teleport Web UI 
<ScopedBlock scope={["oss", "enterprise"]}>and `access_request.review` if reviewing the audit log on the Auth Service host</ScopedBlock>.

## Next steps

- Read our guides to configuring [Resource Access
    Requests](../access-requests/resource-requests.mdx) and [Role Access
    Requests](../access-requests/role-requests.mdx) so you can get the most out
    of your Access Request plugins.
## Feedback

If you have any issues with this plugin, please create a GitHub issue in our [`gravitational/teleport-plugins`](https://github.com/gravitational/teleport-plugins/issues/new) repo.
